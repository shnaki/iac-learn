services:
  localstack:
    image: localstack/localstack:latest
    container_name: iac-learn-localstack
    ports:
      - "4566:4566"
    environment:
      - SERVICES=iam,lambda,logs,sts,ec2,ecs,ecr,stepfunctions,events
      - DEBUG=1
      - AWS_DEFAULT_REGION=ap-northeast-1
    volumes:
      - localstack-data:/var/lib/localstack
      - /var/run/docker.sock:/var/run/docker.sock
    healthcheck:
      test:
        [
          "CMD",
          "bash",
          "-c",
          "curl -sf http://localhost:4566/_localstack/health >/dev/null",
        ]
      interval: 10s
      timeout: 5s
      retries: 10

volumes:
  localstack-data:
